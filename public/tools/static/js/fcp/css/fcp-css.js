baidu.namespace.register("baidu.css");baidu.css=(function(){var s=null;var d=null;var G=null;var z=0;var D=null;var B=[];var y=null;var n=function(L){s={curIndex:0,queen:[],callback:new Function(),finished:L};d={}};var e=function(){y={styles:[],cssMinified:{files:[],count:0},backgroundImages:[],expressions:[],duplicatedFiles:[]}};var A=function(){G={matched:{count:0,selectors:[]},unmatched:{count:0,selectors:[]},ignored:{count:0,selectors:[]}}};var k=function(L){s.queen.push(L)};var c=function(){return s.queen[s.curIndex]};var i=function(){return(s.curIndex==s.queen.length)};var I=function(){s.curIndex+=1};var f=function(){return s.finished};var l=function(N){var L=/(.*\/)([^\/]+\.css)/;var M=L.exec((N||"").replace(/\?.*/,""));D=M?M[1]:""};var u=function(){return D||""};var v=function(N){var L=/(.*\/)([^\/]+\.css)/;var M=L.exec((N||"").replace(/\?.*/,""));return M?M[2]:"styleÂùó"+ ++z};var m=function(O,N){N=N.replace(/\/\*[\S\s]*?\*\//g,"");var L=v(O);B.push({href:O?O:"#",fileName:L,fileContent:N});try{var M=/@import\s+url\(\s*(\"|\')(.*)\1\s*\)(\s*;)?/ig;N.replace(M,function(R,Q,S){k({link:{href:u()+S},style:null})})}catch(P){}};var j=function(M){if(M.indexOf("http://")!=0){M=M.replace(/['"]/g,"");var L=u();if(M.indexOf("/")==0){L=""}else{if(M.indexOf("./")==0){M=M.substr(2)}else{if(M.indexOf("../")==0){M=M.substr(3);if(L.lastIndexOf("/")==L.length-1){L=L.substr(0,L.length-1)}L=L.substr(0,L.lastIndexOf("/")+1)}}}M=L+M}return M};var b=function(M,O){var N=/(background|background-image):(?:[\#\w]+\s+)?url\(([^\)]*)\)/ig;var L=[];O.replace(/\/\*[\S\s]*?\*\//g,"").replace(/\r?\n/,"").replace(/\s+\'|\"/g,"").replace(N,function(Q,P,R){R=R.replace(/\?.*/,"");L.push(j(R))});if(L.length){y.backgroundImages.push({fileName:M,bgImages:L})}};var E=function(M,O){var N=/:expression\(/ig;var L=O.replace(/\/\*[\S\s]*?\*\//g,"").replace(/\r?\n/,"").replace(/\s+/g,"").split(N);if(L.length-1){y.expressions.push({fileName:M,count:L.length-1})}};var o=function(N){var L=N.fileContent.split(/\n/);var M=N.fileContent.length/L.length;if(M<150&&L.length>1){y.cssMinified.count++;y.cssMinified.files.push({href:N.href,fileName:N.fileName})}};var C=function(L){var M=(function(){var N={link:[],style:[]};jQuery.each(L,function(P,O){if(!!O.href){N.link.push(O)}else{N.style.push(O)}});return N})();return M};var K=function(L){l(L.href);chrome.extension.sendMessage(null,{type:MSG_TYPE.GET_CSS,link:L.href},function(M){m(M.path,M.content);g()})};var r=function(L){m("",L.ownerNode.innerText);g()};var g=function(){var L=c();if(f()||!L){chrome.extension.sendMessage({type:MSG_TYPE.CSS_READY});return}I();if(i()){n(true)}if(!!L.style){r(L.style)}else{if(!!L.link){K(L.link)}}};var t=function(){styleheets=C(document.styleSheets);if(styleheets.style&&styleheets.style.length>0){jQuery.each(styleheets.style,function(L,M){k({link:null,style:M})})}if(styleheets.link&&styleheets.link.length>0){jQuery.each(styleheets.link,function(L,M){k({link:M,style:null})})}g()};var x=function(){return[{type:0,count:G.unmatched.count,content:G.unmatched.selectors},{type:1,count:G.ignored.count,content:G.ignored.selectors},{type:2,count:G.matched.count,content:G.matched.selectors}]};var H=function(){var L=false;jQuery.each(B,function(M,N){q(N)})};var q=function(L){var P=L.fileName;var O=L.fileContent;o(L);E(P,O);b(P,O);var N=(new baidu.cssAnalytic()).run(O);var M=h(N);A();jQuery.each(M,function(Q,R){if(R.selector){a(R.selector,R.csstext)}});y.styles.push({path:P,content:x()})};var h=function(S){var R=[],M="",T=[],O;for(var N=0,P=S.length;N<P;N++){var U=S[N];if(U[1]==baidu.FL.FL_NEW_LINE){continue}else{if(U[1]==baidu.FL.CSS_DEVICE_DESC){M=U[0];O=baidu.FL.CSS_DEVICE_START;continue}else{if(U[1]==baidu.FL.CSS_SELECTOER){M=U[0];O=baidu.FL.CSS_SELECTOER_START;continue}else{if(U[1]==baidu.FL.CSS_AT){M=U[0]}else{var L=N;for(;L<P;L++){var Q=S[L];if(U[1]==baidu.FL.CSS_AT){L--;break}else{if(Q[1]==baidu.FL.CSS_DEVICE_END&&O==baidu.FL.CSS_DEVICE_START){T.push(Q[0]);break}else{if(Q[1]==baidu.FL.CSS_SELECTOER_END&&O==baidu.FL.CSS_SELECTOER_START){T.push(Q[0]);break}else{T.push(Q[0])}}}}N=L}}}}R.push({selector:M,csstext:T.join("")});T=[];O=""}return R};var a=function(M,S){var O=M.replace(/\r?\n/g,"").trim().split(",");var R="",L;var Q=/^([\*\+]+[^ ]+)[ ]+(.*)$/;var N=/([^:]+)(:hover|:focus|:visited|:link|:active|:before|:after|::)/;var P;jQuery.each(O,function(V,T){R=T;L=Q.exec(T);if(L&&L[1]&&L[2]){T=L[2]}var X=false;if(T.indexOf("@")>-1||T.indexOf("-moz-")>-1){d[T]=1}else{if(!d[T]){var U=N.exec(T);if(U&&U[1]){X=true;T=U[1]}try{d[T]=jQuery(T+':not("[id^=fe-helper-],[id^=fe-helper-] '+T+'")').length}catch(W){d[T]=0}}}P=d[T]?X?"ignored":"matched":"unmatched";G[P].count++;G[P].selectors.push({selector:R,cssText:S})})};var p=function(){H()};var J=function(){styleheets=C(document.styleSheets);var N={};var M=[];var L={};if(styleheets.link&&styleheets.link.length>0){jQuery.each(styleheets.link,function(O,P){N[P.href]=parseInt(N[P.href]||0,10)+1});jQuery.each(N,function(O,Q){if(Q>1){M.push({href:O,count:Q})}else{var P="";var R=[];jQuery.each(B,function(T,S){if(S.href==O){P=S.fileContent.replace(/\s+/g,"");return false}});jQuery.each(B,function(T,S){if(P==S.fileContent.replace(/\s+/g,"")&&!L[S.href]&&R.join(",").indexOf(S.href)==-1){R.push(S.href)}});if(R.length>1){M.push({href:O,dupFiles:R});L[O]=true}}})}y.duplicatedFiles=M};var F=function(){n(false);t()};var w=function(L){e();p();J();if(L&&typeof L=="function"){L.call(null,y)}};return{init:F,detect:w}})();