baidu.namespace.register("baidu.htmlAnalytic");baidu.htmlAnalytic=function(){this.parsePos=0;this.content="";this.contentLength=0;this.singleTag=["br","input","link","meta","!doctype","basefont","base","area","hr","wbr","param","img","isindex","?xml","embed"];this.closeTagWhiteList=["html","body","li","tr","td"];this._output=[];this.__construct=function(){};this.run=function(b,a){if(a==undefined){a=1}this.content=b.trim().replace(/\r\n/g,"\n");if(this.content.indexOf("<?xml")>-1){return[[b,baidu.FL.HTML_XML]]}this.contentLength=this.content.length;if(a===1){this.tokenAnalytic();return this._output}return this.getTagAttributes(b)};this.tokenAnalytic=function(){var a;while(true){a=this.getNextToken();if(a){if(a[1]===baidu.FL.FL_EOF){break}this._output.push(a)}}};this.getNextToken=function(){if(this.parsePos>=this.contentLength){return["",baidu.FL.FL_EOF]}var a=this.content[this.parsePos];this.parsePos++;var d=this._output.length;var c;if(d){var b=this._output[d-1][1];if(b===baidu.FL.HTML_JS_START){c=this._getScriptOrStyleContent(a,1);if(c){return c}}else{if(b===baidu.FL.HTML_CSS_START){c=this._getScriptOrStyleContent(a,2);if(c){return c}}else{if(b===baidu.FL.HTML_TEXTAREA_START){c=this._getTextareaOrPreContent(a,1);if(c){return c}}else{if(b===baidu.FL.HTML_PRE_START){c=this._getTextareaOrPreContent(a,2);if(c){return c}}}}}}if(a==="\x0d"){return""}if(a==="\x0a"){return[a,baidu.FL.FL_NEW_LINE]}if(a==="<"&&this.content[this.parsePos]!=="<"){c=this._getTagToken(a);if(c){return c}}c=this._getContentToken(a);if(c){return c}return[a,baidu.FL.FL_NORMAL]};this._getTagToken=function(a){var b=a;do{if(this.parsePos>=this.contentLength){break}a=this.content[this.parsePos];this.parsePos++;if(a==='"'||a==="'"){if(b[1]!=="!"){b+=a;b+=this._getUnformated(a)}}else{b+=a}}while(a!==">");if(b[1]==="!"){if(b.indexOf("[if")>-1){if(b.indexOf("!IE")>-1){b+=this._getUnformated("-->",b)}return[b,baidu.FL.HTML_IE_HACK_START]}else{if(b.indexOf("[[endif")>-1){return[b,baidu.FL.HTML_IE_HACK_EDN]}else{if(this._checkEqual(b,2,7,"doctype")){return[b,baidu.FL.HTML_DOC_TYPE]}else{if(this._checkEqual(b,4,6,"status")){b+=this._getUnformated("-->",b);return[b,baidu.FL.HTML_STATUS_OK]}else{b+=this._getUnformated("-->",b);return[b,baidu.FL.HTML_COMMENT]}}}}}if(this._checkEqual(b,0,7,"<script")){return[b,baidu.FL.HTML_JS_START]}else{if(this._checkEqual(b,0,9,"<\/script>")){return[b,baidu.FL.HTML_JS_END]}else{if(this._checkEqual(b,0,6,"<style")){return[b,baidu.FL.HTML_CSS_START]}else{if(this._checkEqual(b,0,8,"</style>")){return[b,baidu.FL.HTML_CSS_END]}else{if(this._checkEqual(b,0,9,"<textarea")){return[b,baidu.FL.HTML_TEXTAREA_START]}else{if(this._checkEqual(b,0,11,"</textarea>")){return[b,baidu.FL.HTML_TEXTAREA_END]}else{if(this._checkEqual(b,0,4,"<pre")){return[b,baidu.FL.HTML_PRE_START]}else{if(this._checkEqual(b,0,6,"</pre>")){return[b,baidu.FL.HTML_PRE_END]}}}}}}}}if(this._checkEqual(b,0,2,"</")){return[b,baidu.FL.HTML_TAG_END]}return[b,baidu.FL.HTML_TAG_START]};this._checkEqual=function(a,d,b,c){return a.substr(d,b).toLowerCase()===c.toLowerCase()};this._getContentToken=function(a){var b=a;while(true){if(this.parsePos>=this.contentLength){break}if(this.content[this.parsePos]==="<"&&this.content[this.parsePos+1]&&this.content[this.parsePos+1]!=="<"&&this.content[this.parsePos+1]!==">"){break}b+=this.content[this.parsePos];this.parsePos++}return[b,baidu.FL.HTML_CONTENT]};this._getUnformated=function(a,b){if(b==undefined){b=""}if(b.indexOf(a)>-1){return""}var c="";do{if(this.parsePos>=this.contentLength){break}$c=this.content[this.parsePos];c+=$c;this.parsePos++}while(c.indexOf(a)==-1);if(a.length===1){while(a===this.content[this.parsePos]){c+=this.content[this.parsePos];this.parsePos++}}return c};this._getScriptOrStyleContent=function(a,b){var e=b==1?"<\/script>":"</style>";var d=e.length;if(this.content.substr(this.parsePos-1,d).toLowerCase()===e){return""}var h=a;while(this.parsePos<this.contentLength){if(this.content.substr(this.parsePos,d).toLowerCase()===e){break}else{h+=this.content[this.parsePos];this.parsePos++}}h=h.trim();var c=["<!--","/*<![CDATA[*/","//<![CDATA["];var f=["//-->","/*]]>*/","//]]>"];for(var g in c){if(h.indexOf(g)===0){h=h.substr(g.length);break}}for(var g in f){if(h.indexOf(g)===(h.length-g.length)){h=h.substr(0,h.length-g.length);break}}return[h.trim(),b===1?baidu.FL.HTML_JS_CONTENT:baidu.FL.HTML_CSS_CONTENT]};this._getTextareaOrPreContent=function(a,b){var d=b==1?"</textarea>":"</pre>";var c=d.length;if(this.content.substr(this.parsePos-1,c).toLowerCase()===d){return""}var e=a;while(this.parsePos<this.contentLength){if(this.content.substr(this.parsePos,c).toLowerCase()===d){break}else{e+=this.content[this.parsePos];this.parsePos++}}return[e.trim(),b===1?baidu.FL.HTML_TEXTAREA_CONTENT:baidu.FL.HTML_PRE_CONTENT]};this.getTagAttributes=function(c){var c=c.trim();if(c.substr(0,2)==="</"){return[baidu.FL.HTML_TAG_END,c.substr(2,c.length-3).trim()]}var b=[baidu.FL.HTML_TAG_START,"",[]];this.parsePos=1;this.contentLength=c.replace(/^>\/|>\/$/g,"").length;var a="";while(true){if(this.parsePos>=this.contentLength){break}$char=this.content[this.parsePos];this.parsePos++;if(!/^[a-z0-9]{1}$/g.test($char)){this.parsePos--;break}else{a+=$char}}b[1]=a;var e=$name="";while(true){if(this.parsePos>=this.contentLength){break}$char=this.content[this.parsePos];this.parsePos++;var d;if($char==='"'||$char==="'"){d=$char+this._getUnformated($char);b[2].push([$name,d])}else{if($char==="="){$name=e;e=""}else{if($char===" "){if(e){if($name){b[2].push([$name,e])}else{b[2].push([e,""])}}$name=e=""}else{if($char!==" "&&$char!="\n"&&$char!="\r"&&$char!="\t"){e+=$char}}}}}if(e){if($name){b[2].push([$name,e])}else{b[2].push([e,""])}}return b};this._in_array=function(d,b){for(var c=0,a=d.length;c<a;c++){if(b.trim()==d[c]){return true}}return false};this._getTagName=function(e,a){var b=/^<([^\s\/>]+)\s*\/?/g;var d=/^<\/([^\s]+)>/g;var c=(a==0?b:d).exec(e);return c?c[1]:""};this.getUnclosedTags=function(f){Array.prototype.remove=function(l){for(var i=this.length-1;i>=0;i--){if(l==this[i].tagName){this.splice(i,1);return true}}return false};var d=this.run(f);var a=[];for(var c=0,e=d.length;c<e;c++){if(d[c][1]===baidu.FL.HTML_PRE_START||d[c][1]===baidu.FL.HTML_PRE_END||d[c][1]===baidu.FL.HTML_TEXTAREA_START||d[c][1]===baidu.FL.HTML_TEXTAREA_END||d[c][1]===baidu.FL.HTML_TAG_START||d[c][1]===baidu.FL.HTML_TAG_END||d[c][1]===baidu.FL.HTML_XML){a.push(d[c])}}var k="";var j=[];var b=[];for(var c=0,e=a.length;c<e;c++){if(a[c][1]!==baidu.FL.HTML_PRE_END&&a[c][1]!==baidu.FL.HTML_TEXTAREA_END&&a[c][1]!==baidu.FL.HTML_TAG_END){k=this._getTagName(a[c][0],0);b.push({tagName:k,outerHTML:a[c][0],type:1})}else{k=this._getTagName(a[c][0],1);if(!b.remove(k)){j.push({tagName:k,outerHTML:a[c][0],type:0})}}}var g=[],h=b.concat(j);for(var c=0,e=h.length;c<e;c++){if((!this._in_array(this.singleTag,h[c].tagName.toLowerCase())||h[c].type==0)&&!this._in_array(this.closeTagWhiteList,h[c].tagName.toLowerCase())){g.push(h[c])}}return g}};